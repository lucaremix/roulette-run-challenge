window.addToTeam = async function() {
            const player = getCurrentPlayer();

            if (!player || !wonPokemon) return;

            try {
                const playerRef = ref(database, `players/${player}`);
                const playerSnapshot = await get(playerRef);
                
                let playerData = playerSnapshot.val() || { coins: 0, team: [] };
                if (!playerData.team) playerData.team = [];

                playerData.team.push({
                    ...wonPokemon,
                    nature: wonPokemon.rolled_nature,
                    ability: wonPokemon.rolled_ability,
                    won_from: 'starter',
                    won_at: Date.now()
                });

                await set(playerRef, playerData);

                const pokemonRef = ref(database, `pools/starter/${wonPokemonKey}`);
                await remove(pokemonRef);

                // Rimuovi il giocatore dall'evento starters
                const eventRef = ref(database, `events/starters/players`);
                const eventSnapshot = await get(eventRef);
                
                eventSnapshot.forEach((childSnapshot) => {
                    if (childSnapshot.val() === player) {
                        remove(ref(database, `events/starters/players/${childSnapshot.key}`));
                    }
                });

                alert(`${wonPokemon.english_name} aggiunto al team!`);
                
                window.location.href = 'index.html';

            } catch (error) {
                console.error('Errore:', error);
                alert('Errore durante l\'aggiunta del Pokemon!');
            }
        };
